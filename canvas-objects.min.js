var ctk={Area:function(){this.CoordinateSystem="screen";this.y1=this.x1=this.y0=this.x0=0;this.width=function(){return this.x1-this.x0+1};this.height=function(){return this.y1-this.y0+1}},AreaMap:function(){this.SourceArea=new ctk.Area;this.TargetArea=new ctk.Area;this.MapX=function(a){a=(a-this.SourceArea.x0)/(this.SourceArea.x1-this.SourceArea.x0);return a=this.TargetArea.x0+a*(this.TargetArea.x1-this.TargetArea.x0)};this.MapY=function(a){a=(a-this.SourceArea.y0)/(this.SourceArea.y1-this.SourceArea.y0);
this.SourceArea.CoordinateSystem!==this.TargetArea.CoordinateSystem&&(a=1-a);return a=this.TargetArea.y0+a*(this.TargetArea.y1-this.TargetArea.y0)};this.UnmapX=function(a){a=(a-this.TargetArea.x0)/(this.TargetArea.x1-this.TargetArea.x0);return a=this.SourceArea.x0+a*(this.SourceArea.x1-this.SourceArea.x0)};this.UnmapY=function(a){a=(a-this.TargetArea.y0)/(this.TargetArea.y1-this.TargetArea.y0);this.SourceArea.CoordinateSystem!==this.TargetArea.CoordinateSystem&&(a=1-a);return a=this.SourceArea.y0+
a*(this.SourceArea.y1-this.SourceArea.y0)}},Canvas:function(){this.Context=this.Canvas=null;this.ClearRect=function(a,b,c,d){return this.Context.clearRect(a,b,c,d)};this.FillRect=function(a,b,c,d){return this.Context.fillRect(a,b,c,d)};this.StrokeRect=function(a,b,c,d){return this.Context.strokeRect(a,b,c,d)};this.FillText=function(a,b,c,d){return this.Context.fillText(a,b,c,d)};this.StrokeText=function(a,b,c,d){return this.Context.strokeText(a,b,c,d)};this.MeasureText=function(a){return this.Context.measureText(a)};
this.BeginPath=function(){return this.Context.beginPath()};this.ClosePath=function(){return this.Context.closePath()};this.MoveTo=function(a,b){return this.Context.moveTo(a,b)};this.LineTo=function(a,b){return this.Context.lineTo(a,b)};this.BezierCurveTo=function(a,b,c,d,e,f){return this.Context.bezierCurveTo(a,b,c,d,e,f)};this.QuadraticCurveTo=function(a,b,c,d){return this.Context.quadraticCurveTo(a,b,c,d)};this.Arc=function(a,b,c,d,e,f){return this.Context.arc(a,b,c,d,e,f)};this.ArcTo=function(a,
b,c,d,e){return this.Context.arcTo(a,b,c,d,e)};this.Rect=function(a,b,c,d){return this.Context.rect(a,b,c,d)};this.Fill=function(){return this.Context.fill()};this.Stroke=function(){return this.Context.stroke()};this.Clip=function(){return this.Context.clip()};this.IsPointInPath=function(a,b){return this.Context.isPointInPath(a,b)};this.IsPointInStroke=function(a,b){return this.Context.isPointInStroke(a,b)};this.DrawImage=function(a,b,c){return this.Context.drawImage(a,b,c)};this.DrawImage=function(a,
b,c,d,e){return this.Context.drawImage(a,b,c,d,e)};this.DrawImage=function(a,b,c,d,e,f,g,h,k){return this.Context.drawImage(a,b,c,d,e,f,g,h,k)};return this},OffScreenCanvas:function(a,b){this.Canvas=document.createElement("canvas");this.Canvas.width=a||100;this.Canvas.height=b||100;this.Context=this.Canvas.getContext("2d");return this}};ctk.OffScreenCanvas.prototype=new ctk.Canvas;ctk.MappedCanvas=function(a,b){this.Canvas=a;this.Context=this.Canvas.getContext("2d");this.Map=b;return this};
ctk.MappedCanvas.prototype=new ctk.Canvas;ctk.ProcessLoop=function(a,b){this.Process=a;this.IntervalMS=b;this.IntervalID=null;this.Reset=function(){this.StopProcess()};this.StartProcess=function(){null===this.IntervalID&&(this.IntervalID=setInterval(this.Process,this.IntervalMS))};this.StopProcess=function(){null!==this.IntervalID&&(clearInterval(this.IntervalID),this.IntervalID=null)}};ctk.Point=function(a,b){this.x=a||null;this.y=b||null};
ctk.DrawLine=function(a,b,c,d,e){a.beginPath();a.moveTo(b,c);a.lineTo(d,e);a.closePath();a.stroke()};ctk.DrawLineStyle=function(a,b,c,d,e,f){a.save();f.MergeToContext(a);ctk.DrawLine(a,b,c,d,e);a.restore()};ctk.DrawDashedLine=function(a,b,c,d,e,f){void 0==f&&(f=2);a.beginPath();a.moveTo(b,c);var g=d-b,h=e-c;f=Math.floor(Math.sqrt(g*g+h*h)/f);for(var g=g/f,h=h/f,k=0;k++<f;)b+=g,c+=h,a[0==k%2?"moveTo":"lineTo"](b,c);a[0==k%2?"moveTo":"lineTo"](d,e);a.closePath();a.stroke()};
ctk.DrawDashedLineStyle=function(a,b,c,d,e,f,g){a.save();g.MergeToContext(a);ctk.DrawDashedLine(a,b,c,d,e,f);a.restore()};ctk.ClearRect=function(a,b,c,d,e){a.clearRect(b,c,d,e)};ctk.DrawRect=function(a,b,c,d,e){a.strokeRect(b,c,d,e)};ctk.DrawRectStyle=function(a,b,c,d,e,f){a.save();f.MergeToContext(a);ctk.DrawRect(a,b,c,d,e);a.restore()};ctk.FillRect=function(a,b,c,d,e){a.fillRect(b,c,d,e)};ctk.FillRectStyle=function(a,b,c,d,e,f){a.save();f.MergeToContext(a);ctk.FillRect(a,b,c,d,e);a.restore()};
ctk.DrawRoundedRect=function(a,b,c,d,e,f){var g=c;d=b+d;var h=c+e;0>e&&(g=h,h=c);0===e&&(h+=f);a.beginPath();a.moveTo(b+f,g);a.lineTo(d-f,g);a.arcTo(d,g,d,g+f,f);a.lineTo(d,h-f);a.arcTo(d,h,d-f,h,f);a.lineTo(b+f,h);a.arcTo(b,h,b,h-f,f);a.lineTo(b,g+f);a.arcTo(b,g,b+f,g,f);a.closePath();a.fillStyle&&a.fill();a.strokeStyle&&a.stroke()};ctk.DrawRoundedRectStyle=function(a,b,c,d,e,f,g){a.save();g.MergeToContext(a);ctk.DrawRoundedRect(a,b,c,d,e,f);a.restore()};
ctk.DrawCircle=function(a,b,c,d){a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.closePath();a.fillStyle&&a.fill();a.strokeStyle&&a.stroke()};ctk.DrawCircleStyle=function(a,b,c,d,e){a.save();e.MergeToContext(a);ctk.DrawCircle(a,b,c,d);a.restore()};ctk.DrawText=function(a,b,c,d){a.fillStyle&&a.fillText(b,c,d);a.strokeStyle&&a.strokeText(b,c,d)};ctk.DrawTextStyle=function(a,b,c,d,e){a.save();e.MergeToContext(a);ctk.DrawText(a,b,c,d);a.restore()};
ctk.Rect=function(a,b,c,d){this.x=a||0;this.y=b||0;this.w=c||0;this.h=d||0;this.x2=function(){return this.x+(this.w-1)};this.y2=function(){return this.y+(this.h-1)};this.xy=function(){return new ctk.Point(this.x,this.y)};this.wh=function(){return new ctk.Point(this.w,this.h)};this.Clone=function(){return new ctk.Rect(this.x,this.y,this.w,this.h)};this.Inflate=function(a){this.x-=a;this.y-=a;this.w+=2*a;this.h+=2*a;return this};this.Deflate=function(a){this.Inflate(-a);return this};this.MoveXY=function(a,
b){this.x=a;this.y=b;return this};this.MoveTo=function(a,b){this.MoveXY(a,b);return this};this.OffsetXY=function(a,b){this.x+=a;this.y+=b;return this};this.OffsetBy=function(a,b){this.OffsetXY(a,b);return this};this.SetSize=function(a,b){this.w=a;this.h=b;return this};return this};
ctk.Border=function(){this.BorderRect=new ctk.Rect;this.BorderStyle=null;this.BorderCornerRadius=this.BorderDepth=0;this.ClientRect=new ctk.Rect;this.ClientStyle=null;this.ContentPadding=this.ClientCornerRadius=0;this.ContentRect=new ctk.Rect;this.MoveXY=function(a,b){this.BorderRect.MoveXY(a,b);return this};this.MoveTo=function(a,b){this.MoveXY(a,b);return this};this.OffsetXY=function(a,b){this.BorderRect.OffsetXY(a,b);return this};this.OffsetBy=function(a,b){this.OffsetXY(a,b);return this};this.SetSize=
function(a,b){this.SetBorderSize(a,b);return this};this.SetBorderSize=function(a,b){this.ClientRect=new ctk.Rect(this.BorderDepth,this.BorderDepth,a-2*this.BorderDepth,b-2*this.BorderDepth);this.ContentRect=this.ClientRect.Clone();this.ContentPadding&&this.ContentRect.Deflate(this.ContentPadding);this.BorderRect=new ctk.Rect(this.BorderRect.x,this.BorderRect.y,a,b);return this};this.SetClientSize=function(a,b){this.ClientRect=new ctk.Rect(this.BorderDepth,this.BorderDepth,a,b);this.ContentRect=this.ClientRect.Clone();
this.ContentPadding&&this.ContentRect.Deflate(this.ContentPadding);this.BorderRect=new ctk.Rect(this.BorderRect.x,this.BorderRect.y,a+2*this.BorderDepth,b+2*this.BorderDepth);return this};this.SetContentSize=function(a,b){this.ContentRect=new ctk.Rect(this.ContentPadding,this.ContentPadding,a,b);this.ClientRect=new ctk.Rect(this.BorderDepth,this.BorderDepth,this.ContentRect.w+2*this.ContentPadding,this.ContentRect.h+2*this.ContentPadding);this.BorderRect=new ctk.Rect(this.BorderRect.x,this.BorderRect.y,
this.ClientRect.w+2*this.BorderDepth,this.ClientRect.h+2*this.BorderDepth);return this};this.Render=function(a,b,c){b=b||0;c=c||0;this.BorderStyle&&(b+=this.BorderRect.x,c+=this.BorderRect.y,a.save(),this.BorderStyle.MergeToContext(a),ctk.DrawRoundedRect(a,b,c,this.BorderRect.w,this.BorderRect.h,5),a.restore());this.ClientStyle&&(b+=this.ClientRect.x,c+=this.ClientRect.y,a.save(),this.ClientStyle.MergeToContext(a),this.ClientStyle.FillStyle&&a.fillRect(b,c,this.ClientRect.w,this.ClientRect.h),this.ClientStyle.StrokeStyle&&
a.strokeRect(b,c,this.ClientRect.w,this.ClientRect.h),a.restore());return this};return this};
ctk.Style=function(){this.GlobalCompositeOperation=this.GlobalAlpha=this.TextBaseline=this.TextAlign=this.Font=this.MiterLimit=this.LineWidth=this.LineJoin=this.LineCap=this.ShadowOffsetY=this.ShadowOffsetX=this.ShadowBlur=this.ShadowColor=this.FillStyle=this.StrokeStyle=null;this.FromContext=function(a){this.StrokeStyle=a.strokeStyle;this.FillStyle=a.fillStyle;this.ShadowColor=a.shadowColor;this.ShadowBlur=a.shadowBlur;this.ShadowOffsetX=a.shadowOffsetX;this.ShadowOffsetY=a.shadowOffsetY;this.LineCap=
a.lineCap;this.LineJoin=a.lineJoin;this.LineWidth=a.lineWidth;this.MiterLimit=a.miterLimit;this.Font=a.font;this.TextAlign=a.textAlign;this.TextBaseline=a.textBaseline;this.GlobalAlpha=a.globalAlpha;this.GlobalCompositeOperation=a.globalCompositeOperation};this.CopyToContext=function(a){a.strokeStyle=this.StrokeStyle;a.fillStyle=this.FillStyle;a.shadowColor=this.ShadowColor;a.shadowBlur=this.ShadowBlur;a.shadowOffsetX=this.ShadowOffsetX;a.shadowOffsetY=this.ShadowOffsetY;a.lineCap=this.LineCap;a.lineJoin=
this.LineJoin;a.lineWidth=this.LineWidth;a.miterLimit=this.MiterLimit;a.font=this.Font;a.textAlign=this.TextAlign;a.textBaseline=this.TextBaseline;a.globalAlpha=this.GlobalAlpha;a.globalCompositeOperation=this.GlobalCompositeOperation};this.MergeToContext=function(a){a.strokeStyle=this.StrokeStyle||a.strokeStyle;a.fillStyle=this.FillStyle||a.fillStyle;a.shadowColor=this.ShadowColor||a.shadowColor;a.shadowBlur=this.ShadowBlur||a.shadowBlur;a.shadowOffsetX=this.ShadowOffsetX||a.shadowOffsetX;a.shadowOffsetY=
this.ShadowOffsetY||a.shadowOffsetY;a.lineCap=this.LineCap||a.lineCap;a.lineJoin=this.LineJoin||a.lineJoin;a.lineWidth=this.LineWidth||a.lineWidth;a.miterLimit=this.MiterLimit||a.miterLimit;a.font=this.Font||a.font;a.textAlign=this.TextAlign||a.textAlign;a.textBaseline=this.TextBaseline||a.textBaseline;a.globalAlpha=this.GlobalAlpha||a.globalAlpha;a.globalCompositeOperation=this.GlobalCompositeOperation||a.globalCompositeOperation};this.MergeToStyle=function(a){a.StrokeStyle=this.StrokeStyle||a.StrokeStyle;
a.FillStyle=this.FillStyle||a.FillStyle;a.ShadowColor=this.ShadowColor||a.ShadowColor;a.ShadowBlur=this.ShadowBlur||a.ShadowBlur;a.ShadowOffsetX=this.ShadowOffsetX||a.ShadowOffsetX;a.ShadowOffsetY=this.ShadowOffsetY||a.ShadowOffsetY;a.LineCap=this.LineCap||a.LineCap;a.LineJoin=this.LineJoin||a.LineJoin;a.LineWidth=this.LineWidth||a.LineWidth;a.MiterLimit=this.MiterLimit||a.MiterLimit;a.Font=this.Font||a.Font;a.TextAlign=this.TextAlign||a.TextAlign;a.TextBaseline=this.TextBaseline||a.TextBaseline;
a.GlobalAlpha=this.GlobalAlpha||a.GlobalAlpha;a.GlobalCompositeOperation=this.GlobalCompositeOperation||a.GlobalCompositeOperation};this.MergeFromStyle=function(a){a.ApplyToStyle(this)}};ctk.LineStyle=function(a,b,c){ctk.Style.call(this);this.LineWidth=a;this.StrokeStyle=b;this.FillStyle=c};ctk.LineStyle.prototype=Object.create(ctk.Style.prototype);ctk._TextMeasureCanvas=new ctk.OffScreenCanvas;
ctk.Item=function(){this.Image=this.TextStyle=this.Text=this.Border=null;this.MoveXY=function(a,b){this.Border&&this.Border.BorderRect.MoveXY(a,b);return this};this.MoveTo=function(a,b){this.MoveXY(a,b);return this};this.OffsetXY=function(a,b){this.Border&&this.Border.BorderRect.OffsetXY(a,b);return this};this.OffsetBy=function(a,b){this.OffsetXY(a,b);return this};this.SetSize=function(a,b){this.Border&&this.Border.SetSize(a,b);return this};this.FitText=function(a,b,c){b=b||a.canvas.clientWidth;a=
new ctk.Rect(0,0,b,c||a.canvas.clientHeight);if(this.Text){ctk._TextMeasureCanvas.Context.save();this.TextStyle&&this.TextStyle.MergeToContext(ctk._TextMeasureCanvas.Context);ctk._TextMeasureCanvas.Context.textAlign="start";ctk._TextMeasureCanvas.Context.textBaseline="hanging";ctk._TextMeasureCanvas.Context.fillStyle="white";ctk._TextMeasureCanvas.Context.clearRect(0,0,ctk._TextMeasureCanvas.Canvas.width,ctk._TextMeasureCanvas.Canvas.height);ctk._TextMeasureCanvas.Context.fillText(this.Text,0,0);
c=ctk._TextMeasureCanvas.Context.measureText(this.Text);c.width<b&&(a.w=c.width);a.h=0;b=ctk._TextMeasureCanvas.Context.getImageData(0,0,100,ctk._TextMeasureCanvas.Canvas.height);for(c=b.height-1;0<=c;c--){for(var d=0;d<b.width;d++)if(255===b.data[4*c*b.width+4*d]){a.h=c+1;break}if(0<a.h)break}ctk._TextMeasureCanvas.Context.restore()}this.Border&&this.Border.SetContentSize(a.w,a.h);return this};this.Render=function(a,b,c){b=b||0;c=c||0;var d=new ctk.Rect(b,c,a.canvas.clientWidth-b,a.canvas.clientHeight-
c);this.Border&&(this.Border.Render(a,b,c),d=this.Border.ContentRect.Clone(),d.OffsetBy(this.Border.ClientRect.x,this.Border.ClientRect.y),d.OffsetBy(this.Border.BorderRect.x,this.Border.BorderRect.y),d.OffsetBy(b,c));this.Text&&this.TextStyle&&(a.save(),this.TextStyle.MergeToContext(a),a.textAlign="start",a.textBaseline="hanging",this.TextStyle.FillStyle&&a.fillText(this.Text,d.x,d.y,d.w),this.TextStyle.StrokeStyle&&a.strokeText(this.Text,d.x,d.y,d.w),a.restore());return this};return this};
